<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>攻略</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <!-------------jquery库-------------->
    <script type="text/javascript" src="${ctxPath}/js/jquery-2.1.1.min.js"></script>
    <!-------------Amazeui--------------->
    <script type="text/javascript" src="${ctxPath}/js/amazeui.js"></script>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="${ctxPath}/css/amazeui.css">
    <!------------核心样式-------------->
    <link rel="stylesheet" type="text/css" href="${ctxPath}/css/style.css">
</head>
<body>
<!-------------------工具栏------------------->
<%layout("/include/top.html"){}%>
<!------------------游记版头-------------------->

<div id="note_head">
    <div class="head">
        <div class="banner"><img src="${strategy.icon}"/></div>
        <div class="title">
            <div class="cw1200"><p>${strategy.title}</p></div>
        </div>
    </div>
    <div class="user">
        <div class="cw1200">
            <div class="pic"><img src="${strategy.userPhoto}"/></div>
            <div class="meta">
                <label>作者：${strategy.userName}</label>
                <span>发布于：${strategy.time,dateFormat="yyyy-MM-dd"}</span>
            </div>
            <div class="operation">
            </div>
        </div>
    </div>
</div>

<!------------------子页框架-------------------->
<div id="sub_from">
    <div class="cw1200">
        <div class="w810 fl">
            <!------------------公共盒子-------------------->
            <div class="public_box bg1">
                <div class="public_title">
                    <div class="fl"><img src="${ctxPath}/image/from_title_left.png"/></div>
                    <div class="con">
                        <div class="lamp_ico"><img src="${ctxPath}/image/lamp_ico.png"/></div>
                        <div class="name"><img src="${ctxPath}/image/f_t_article.png"/></div>
                    </div>
                    <div class="fr"><img src="${ctxPath}/image/from_title_right.png"/></div>
                    <div class="clear"></div>
                </div>
                <!------------------文章-------------------->
                <div id="article">

                    <div class="con">
                        <%for(item in strategy.introduceList){%>
                        <%if(itemLP.index==1){%>
                        <p>${item}</p>
                        <%}%>
                        <%}%>
                        <%for(item in strategy.imgList){%>
                        <%if(itemLP.index==1){%>
                        <img src="${item}" alt=""/>
                        <%}%>
                        <%}%>
                        <%for(item in strategy.introduceList){%>
                        <%if(itemLP.index==2){%>
                        <p>${item}</p>
                        <%}%>
                        <%}%>
                        <%for(item in strategy.imgList){%>
                        <%if(itemLP.index==2){%>
                        <img src="${item}" alt=""/>
                        <%}%>
                        <%}%>
                        <%for(item in strategy.introduceList){%>
                        <%if(itemLP.index==3){%>
                        <p>${item}</p>
                        <%}%>
                        <%}%>
                        <%for(item in strategy.imgList){%>
                        <%if(itemLP.index==3){%>
                        <img src="${item}" alt=""/>
                        <%}%>
                        <%}%>
                    </div>
                </div>

            </div>
            <!------------------公共盒子-------------------->
            <div class="public_box bg1">
                <div class="public_title">
                    <div class="fl"><img src="${ctxPath}/image/from_title_left.png"/></div>
                    <div class="con">
                        <div class="lamp_ico"><img src="${ctxPath}/image/lamp_ico.png"/></div>
                        <div class="name"><img src="${ctxPath}/image/f_t_comment.png"/></div>
                    </div>
                    <div class="fr"><img src="${ctxPath}/image/from_title_right.png"/></div>
                    <div class="clear"></div>
                </div>
                <!------------------评论-------------------->
                <div id="comment">
                    <form action="${ctxPath}/comment/addComment" method="post">
                        <div class="modal-body">
                            <div class="form-group">
                                <input type="hidden" name="strategyId" value="${strategy.id}"/>
                                <label for="commentText" class="control-label">请输入你的评论:</label>
                                <textarea class="form-control" name="comment" id="commentText"></textarea>
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-primary" id="suBtn">提交</button>
                                </div>
                            </div>
                        </div>
                    </form>
                    <div class="list">
                        <div class="tag">
                            <a class="cur" id="asc" onclick="A('${strategy.id}')"
                               href="javascript:void (0)">最新评论</a><span>|</span><a id="desc" onclick="B('${strategy.id}')"
                                                                                   href="javascript:void (0)">正序排列</a>
                        </div>
                        <input type="hidden" value="${strategy.id}" id="low"/>
                        <ul id="commentId">
                        </ul>
                        <nav aria-label="Page navigation">
                            <ul class="pagination">

                            </ul>
                        </nav>
                    </div>
                </div>

            </div>
        </div>
        <div class="w380 fr">
            <!------------------公共盒子-------------------->
            <div class="public_box bg2">
                <div class="public_title">
                    <div class="fl"><img src="${ctxPath}/image/from_title_left.png"/></div>
                    <div class="con">
                        <div class="lamp_ico"><img src="${ctxPath}/image/lamp_ico.png"/></div>
                        <div class="name"><img src="${ctxPath}/image/f_t_other_share.png"/></div>
                        <div class="more"><a href="note_list.html">更多>></a></div>
                    </div>
                    <div class="fr"><img src="${ctxPath}/image/from_title_right.png"/></div>
                    <div class="clear"></div>
                </div>
                <!------------------其他人分享-------------------->
                <div id="other_share">
                    <ul>
                        <%for(item in strategyList){%>
                        <%if(itemLP.index<5){%>
                        <li>
                            <div class="pic">
                                <div class="cover"><a href="${ctxPath}/strategy/strategyDetails?id=${item.id}"><img class="scale-effect "
                                                                            src="${strategy.icon}"/></a>
                                </div>
                                <div class="head"><img src="${strategy.userPhoto}"/></div>
                            </div>
                            <div class="meta">
                                <p><a href="note.html">${strategy.title}</a></p>
                                <span>作者：${strategy.userName}</span>
                            </div>
                        </li>
                        <%}%>
                        <%}%>
                    </ul>
                </div>
            </div>
        </div>
        <div class="clear"></div>
    </div>
</div>
<input type="hidden" value="${strategy.id}" id="high"/>
<!-----------------版底---------------->
<div id="footer">
    <div class="cw1200">
        <div class="line"><img src="${ctxPath}/image/b_line.png"/></div>
        <div class="b_logo"><img src="${ctxPath}/image/b_logo.png"/></div>
        <div class="con">
            <p>Zhiqi文化旅游发展有限公司 版权所有</p>
            <p>地址：河南省洛阳市Zhiqi文化游客接待中心　邮编：000000　电话：0000-00000000　业务电话：0000-0000000</p>
            <p>Copyright 2019 zhiqi All Rights Reserved | 豫ICP备00000000号　技术支持：zhiqi</p>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>

    var oneId = $("#low").val();
    $(function () {

        A(oneId)
    })

    function A(id) {
        $.ajax({
            type: "GET",
            url: "${ctxPath}/strategy/strategyCommentDesc",
            data: {

                "id": id
            },
            success: function (res) {
                initComment(res.list)
                initPage(res)
                $("#asc").addClass("cur");
                $("#desc").removeClass("cur");
            }
        })
    }

    function initComment(res) {
        $("#commentId").empty();
        $.each(res, function () {
            $('<li>\n' +
                '                                <div class="pic"><img src="' + this.phone + '"/></div>\n' +
                '                                <div class="con">\n' +
                '                                    <label>' + this.memberName + '</label>\n' +
                '                                    <p>' + this.comment + '</p>\n' +
                '                                    <span>发表于：' + this.commentTime + '</span>\n' +
                '                                </div>\n' +
                '                                <div class="tip"><span class="t_a t_box">沙发</span></div>\n' +
                '                            </li>').appendTo("#commentId")
        })
    }

    function B(id) {
        $.ajax({
            type: "GET",
            url: "${ctxPath}/strategy/strategyCommentDesc",
            data: {
                "id": id,
                "pid": "2"
            },
            success: function (res) {
                initComment(res.list)
                $("#desc").addClass("cur");
                $("#asc").removeClass("cur");
            }
        });
    }

    function initPage(info) {
        $('.pagination').empty();
        if (info.isFirstPage) {
            $('<li class="disabled"><a href="javascript:void(0)">上一页</a></li>').appendTo(".pagination")
        } else {
            $('<li><a class="navA" href="javascript:void(0)" pageNum="' + (info.pageNum - 1) + '" >上一页</a></li>').appendTo(".pagination")
        }
        $.each(info.navigatepageNums, function () {
            if (this == info.pageNum) {
                $('<li class="active"><a  href="javascript:void(0)"><span id="currentPage">' + this + '</span> <span class="sr-only">(current)</span></a></li>').appendTo(".pagination")
            } else {
                $(' <li><a class="navA" pageNum="' + this + '" href="javascript:void(0)">' + this + '</a></li>').appendTo(".pagination")
            }
        })
        if (info.isLastPage) {
            $('<li class="disabled"><a href="javascript:void(0)">下一页</a></li>').appendTo(".pagination")
        } else {
            $('<li><a class="navA" href="javascript:void(0)" pageNum="' + (info.pageNum + 1) + '">下一页</a></li>').appendTo(".pagination")
        }
        //这里也可以使用动态委派事件，但是效率低
        $(".navA").click(function () {
            var pn = $(this).attr("pageNum");
            $.ajax({
                type: "GET",
                url: "${ctxPath}/strategy/strategyCommentDesc",
                data: {

                    "id": oneId,
                    "pn": pn
                },
                success: function (res) {
                    initComment(res.list)
                    initPage(res)
                }
            })
        })

    }

</script>
</body>
</html>